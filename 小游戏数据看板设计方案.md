# 小游戏数据看板设计方案

## 一、设计目标

针对小游戏项目的特殊性，设计一个专门的数据看板，展示：
- 各游戏的受欢迎程度和使用情况
- 玩家游戏会话分析（时长、存档操作等）
- 游戏分类偏好统计
- 玩家行为分析（新游戏 vs 继续游戏）

## 二、数据结构分析

### 2.1 追踪的事件类型

| 事件类型 | 说明 | 数据字段 |
|---------|------|---------|
| `gs` | 游戏会话开始 | `{g: 游戏ID, n: 游戏名称}` |
| `ge` | 游戏会话结束 | `{g: 游戏ID, d: 时长(ms), sv: 有存档, so: 存档操作数}` |
| `so` | 存档操作 | `{g: 游戏ID, op: 操作类型(del/cls/load)}` |
| `pv` | 页面访问 | `{p: 页面名称}` |
| `ua` | 用户行为 | `{a: 动作, ...}` |
| `stats` | 统计数据 | `{gc: 游戏点击, cc: 分类浏览, sc: 搜索次数}` |

### 2.2 可用游戏列表

| ID | 名称 | 英文名 | 分类 | 难度 |
|----|------|--------|------|------|
| tetris | 俄罗斯方块 | Tetris | puzzle | 中等 |
| hextris | 六边形俄罗斯方块 | Hextris | puzzle | 中等 |
| adarkroom | 小黑屋 | A Dark Room | rpg | 困难 |
| candybox2 | 糖果盒子2 | Candy Box 2 | rpg | 中等 |
| liferestart | 人生重开模拟器 | Life Restart | rpg | 简单 |

### 2.3 分类信息

- `all` - 全部
- `puzzle` - 益智
- `rpg` - 角色扮演
- `strategy` - 策略

## 三、看板布局设计

```
┌─────────────────────────────────────────────────────────────┐
│  🎮 小游戏数据看板                          [刷新] [日期选择] │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │ 总游戏数 │ │ 总会话数 │ │ 平均时长 │ │ 活跃用户 │       │
│  │    5     │ │  1,234   │ │  8.5分钟 │ │    89    │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
│                                                               │
│  ┌──────────────────────────────────┐ ┌───────────────────┐ │
│  │        游戏热度排行               │ │   游戏分类偏好     │ │
│  │  ┌─────────────────────────┐     │ │   (饼图)          │ │
│  │  │ 🧩 俄罗斯方块    456次   │     │ │                   │ │
│  │  │ 🔄 人生重开模拟器 389次  │     │ │   RPG    45%      │ │
│  │  │ 🏚️ 小黑屋        234次  │     │ │   益智   35%      │ │
│  │  │ ⬢ 六边形俄罗斯方块 178次 │     │ │   策略   20%      │ │
│  │  │ 🍬 糖果盒子2     123次   │     │ │                   │ │
│  │  └─────────────────────────┘     │ └───────────────────┘ │
│  └──────────────────────────────────┘                     │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │               游戏会话时长分布 (柱状图)                 │   │
│  │  显示各游戏的平均会话时长、总时长对比                      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                               │
│  ┌──────────────────────────────────┐ ┌───────────────────┐ │
│  │       存档操作统计                 │ │   新游戏 vs 继续   │ │
│  │   (各游戏的存档操作次数)           │ │   (环形图)         │ │
│  │                                   │ │                   │ │
│  │  小黑屋: 145次                    │ │    新游戏  62%    │ │
│  │  人生重开: 98次                   │ │    继续    38%    │ │
│  │  糖果盒子2: 67次                  │ │                   │ │
│  └──────────────────────────────────┘ └───────────────────┘ │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                      最近游戏活动                         │ │
│  │  ┌───────────────────────────────────────────────────┐  │ │
│  │  │ 2分钟前   玩家 开始了 俄罗斯方块                   │  │ │
│  │  │ 5分钟前   玩家 继续了 小黑屋 (有存档)              │  │ │
│  │  │ 8分钟前   玩家 完成了 人生重开模拟器 时长15分钟     │  │ │
│  │  │ 12分钟前  玩家 切换到 RPG 分类                     │  │ │
│  │  └───────────────────────────────────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 四、详细功能设计

### 4.1 核心指标卡片

1. **总游戏数** - 显示可用的游戏总数 (5款)
2. **总会话数** - 日期范围内的游戏会话总数 (gs事件)
3. **平均时长** - 所有会话的平均时长 (计算ge事件的d字段)
4. **活跃用户** - 活跃玩家数量 (从data.u + 事件中的user_id计算)

### 4.2 游戏热度排行组件

**数据来源:**
- `stats` 事件中的 `gc` (gameClicks) 字段
- `gs` 事件统计各游戏启动次数
- `ua` 事件中 action=`game_click` 统计

**展示内容:**
- 游戏图标 + 名称
- 点击/启动次数
- 环比变化 (可选)

### 4.3 游戏分类偏好组件 (饼图)

**数据来源:**
- `stats` 事件中的 `cc` (categoryViews) 字段
- `ua` 事件中 action=`category_change` 统计

**展示内容:**
- 各分类的浏览次数
- 百分比占比

### 4.4 游戏会话时长分布 (柱状图)

**数据来源:**
- `gs` + `ge` 事件配对
- 计算每个会话的时长 (ge.d字段)
- 按游戏分组统计

**展示内容:**
- X轴: 各游戏名称
- Y轴: 平均时长 (分钟)
- 可选: 显示最长会话、最短会话

### 4.5 存档操作统计

**数据来源:**
- `so` 事件统计
- `ge` 事件中的 `so` 字段

**展示内容:**
- 各游戏的存档操作次数
- 操作类型分布 (删除/清除/读取)

### 4.6 新游戏 vs 继续游戏

**数据来源:**
- `ua` 事件中 action=`game_open_new`
- `ua` 事件中 action=`game_open_with_save`

**展示内容:**
- 新游戏次数 vs 继续游戏次数
- 环形图展示占比

### 4.7 最近游戏活动时间线

**数据来源:**
- `gs` 事件 - 游戏开始
- `ge` 事件 - 游戏结束
- `so` 事件 - 存档操作
- `ua` 事件中 action=`category_change`

**展示内容:**
- 时间倒序的活动流
- 显示: 时间、玩家、行为、相关游戏/分类

## 五、数据处理逻辑

### 5.1 游戏热度计算

```javascript
function calculateGamePopularity(events) {
  const gameStats = {}

  // 从stats事件聚合数据
  events.filter(e => e.t === 'stats').forEach(event => {
    if (event.d.gc) {
      Object.entries(event.d.gc).forEach(([gameId, count]) => {
        gameStats[gameId] = (gameStats[gameId] || 0) + count
      })
    }
  })

  // 从game_click事件统计
  events.filter(e => e.t === 'ua' && e.d.a === 'game_click').forEach(event => {
    const gameId = event.d.g
    if (gameId) {
      gameStats[gameId] = (gameStats[gameId] || 0) + 1
    }
  })

  // 从gs事件统计会话数
  events.filter(e => e.t === 'gs').forEach(event => {
    const gameId = event.d.g
    if (gameId) {
      gameStats[gameId] = (gameStats[gameId] || 0) + 1
    }
  })

  return gameStats
}
```

### 5.2 会话时长分析

```javascript
function analyzeSessionDuration(events) {
  const sessions = []

  // 配对gs和ge事件
  const sessionStarts = new Map()
  events.filter(e => e.t === 'gs').forEach(event => {
    sessionStarts.set(event.ts, event.d)
  })

  events.filter(e => e.t === 'ge').forEach(event => {
    const gameId = event.d.g
    const duration = event.d.d // 毫秒
    sessions.push({
      game: gameId,
      duration: duration,
      hasSave: event.d.sv,
      saveOps: event.d.so || 0
    })
  })

  // 按游戏分组统计
  const byGame = {}
  sessions.forEach(session => {
    if (!byGame[session.game]) {
      byGame[session.game] = {
        totalDuration: 0,
        count: 0,
        maxDuration: 0,
        minDuration: Infinity
      }
    }
    byGame[session.game].totalDuration += session.duration
    byGame[session.game].count++
    byGame[session.game].maxDuration = Math.max(byGame[session.game].maxDuration, session.duration)
    byGame[session.game].minDuration = Math.min(byGame[session.game].minDuration, session.duration)
  })

  // 计算平均值
  Object.keys(byGame).forEach(gameId => {
    byGame[gameId].avgDuration = byGame[gameId].totalDuration / byGame[gameId].count
  })

  return byGame
}
```

### 5.3 分类偏好计算

```javascript
function calculateCategoryPreference(events) {
  const categoryStats = {
    all: 0,
    puzzle: 0,
    rpg: 0,
    strategy: 0
  }

  // 从stats事件读取
  events.filter(e => e.t === 'stats').forEach(event => {
    if (event.d.cc) {
      Object.entries(event.d.cc).forEach(([category, count]) => {
        categoryStats[category] = (categoryStats[category] || 0) + count
      })
    }
  })

  // 从category_change事件统计
  events.filter(e => e.t === 'ua' && e.d.a === 'category_change').forEach(event => {
    const toCategory = event.d.to
    if (toCategory) {
      categoryStats[toCategory] = (categoryStats[toCategory] || 0) + 1
    }
  })

  return categoryStats
}
```

### 5.4 新游戏 vs 继续游戏统计

```javascript
function calculateNewVsContinue(events) {
  let newGame = 0
  let continueGame = 0

  events.filter(e => e.t === 'ua').forEach(event => {
    if (event.d.a === 'game_open_new') {
      newGame++
    } else if (event.d.a === 'game_open_with_save') {
      continueGame++
    }
  })

  return { newGame, continueGame }
}
```

## 六、组件设计

### 6.1 组件结构

```
MiniGamesDashboard.vue
├── MiniGamesStatsCards.vue      # 核心指标卡片
├── GamePopularityList.vue       # 游戏热度排行
├── CategoryPreferenceChart.vue  # 分类偏好饼图
├── SessionDurationChart.vue     # 会话时长柱状图
├── SaveOperationStats.vue       # 存档操作统计
├── NewVsContinueChart.vue       # 新游戏vs继续游戏
└── GameActivityTimeline.vue     # 最近活动时间线
```

### 6.2 复用现有组件

- `EventTypeChart.vue` - 可复用于分类偏好饼图
- `TrendChart.vue` - 可复用于会话时长趋势
- `EventTable.vue` - 可修改为游戏活动时间线

## 七、游戏信息映射

需要在看板中维护一个游戏信息映射表：

```javascript
const GAMES_INFO = {
  tetris: {
    id: 'tetris',
    name: '俄罗斯方块',
    englishName: 'Tetris',
    icon: '🧩',
    category: 'puzzle',
    color: '#667eea'
  },
  hextris: {
    id: 'hextris',
    name: '六边形俄罗斯方块',
    englishName: 'Hextris',
    icon: '⬢',
    category: 'puzzle',
    color: '#3498db'
  },
  adarkroom: {
    id: 'adarkroom',
    name: '小黑屋',
    englishName: 'A Dark Room',
    icon: '🏚️',
    category: 'rpg',
    color: '#2d3748'
  },
  candybox2: {
    id: 'candybox2',
    name: '糖果盒子2',
    englishName: 'Candy Box 2',
    icon: '🍬',
    category: 'rpg',
    color: '#ff6b9d'
  },
  liferestart: {
    id: 'liferestart',
    name: '人生重开模拟器',
    englishName: 'Life Restart',
    icon: '🔄',
    category: 'rpg',
    color: '#48bb78'
  }
}

const CATEGORIES_INFO = {
  all: { name: '全部', icon: '🎮', color: '#999' },
  puzzle: { name: '益智', icon: '🧩', color: '#667eea' },
  rpg: { name: '角色扮演', icon: '⚔️', color: '#ff6b9d' },
  strategy: { name: '策略', icon: '🎯', color: '#48bb78' }
}
```

## 八、实现建议

### 8.1 创建专用视图组件

创建 `src/views/MiniGamesDashboard.vue` 作为小游戏专用看板，包含以上所有组件。

### 8.2 路由配置

```javascript
// 在 router/index.js 中
{
  path: '/dashboard/mini-games',
  name: 'MiniGamesDashboard',
  component: () => import('@/views/MiniGamesDashboard.vue'),
  meta: { title: '小游戏数据' }
}
```

### 8.3 从ProjectDashboard重定向检测

在 `ProjectDashboard.vue` 中检测项目类型：

```javascript
// 如果是小游戏项目，使用专用看板
if (project.id === 'built_in_mini_games') {
  // 使用 MiniGamesDashboard 组件或重定向
  return h(MiniGamesDashboard, { project, data, loading })
}
```

## 九、后续扩展

1. **玩家留存分析** - 统计首次游戏后再次游戏的玩家比例
2. **游戏完成率** - 根据不同游戏类型定义完成标准
3. **时段分析** - 分析玩家的活跃时间段
4. **搜索关键词** - 展示热门搜索词
5. **玩家行为漏斗** - 从浏览列表到点击游戏到开始游戏的转化

## 十、视觉设计建议

- 使用游戏图标作为视觉元素
- 采用游戏主题色作为图表颜色
- 保持与小游戏项目一致的深色主题风格
- 使用卡片式布局，清晰分隔不同数据模块
